<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>지점 메인페이지</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- site icon -->
      <link rel="icon" href="images/fevicon.png" type="image/png" />
      <!-- bootstrap css -->
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
      <!-- site css -->
      <link rel="stylesheet" href="/css/style.css" />
      <!-- responsive css -->
      <link rel="stylesheet" href="/css/responsive.css" />
      <!-- color css -->
      <link rel="stylesheet" href="/css/color_2.css" />
      <!-- select bootstrap -->
      <link rel="stylesheet" href="/css/bootstrap-select.css" />
      <!-- scrollbar css -->
      <link rel="stylesheet" href="/css/perfect-scrollbar.css" />
      <!-- custom css -->
      <link rel="stylesheet" href="/css/custom.css" />
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
            
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
     	integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 	  <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
   
   	 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   	 
   	   <style>
	 	html, body {
		    font-family: 'Poppins', 'Noto Sans KR', sans-serif !important;
		}
			
        .msg_list_main::-webkit-scrollbar {
          width: 10px;
        }
        .msg_list_main::-webkit-scrollbar-thumb {
          background-color: grey;
          border-radius: 10px;
          background-clip: padding-box;
          border: 2px solid transparent;
        }
        .msg_list_main::-webkit-scrollbar-track {
          background-color: white;
          border-radius: 10px;
          box-shadow: inset 0px 0px 5px white;
        }
            .msg_list_main {
            height: 500px;
            overflow: hidden; /* 기본적으로 스크롤바 숨김 */
            transition: overflow 1s ease; /* 부드러운 전환 */
          }

          .msg_list_main:hover {
            overflow: auto; /* 마우스 올렸을 때 스크롤바 표시 */
          }
          
          .msg_list {
			   list-style-type: none;
			   padding: 0;
			   margin: 0;
			}
			
			.item-row {
			   display: flex;
			   align-items: center;
			   padding: 10px 0;
			   border-bottom: 1px solid #ddd;
			}
			
			.item-image {
			   flex: 0 0 120px; /* 고정 크기 */
			   text-align: center;
			}
			
			.item-info {
			   width: 65%; /* 제품명 span의 고정 너비 설정 */
			   margin-right: 5px; /* 팔린갯수와의 간격 */
			   overflow: hidden;
			   white-space: nowrap;
			   text-overflow: ellipsis; /* 텍스트 길면 ... */
			}
			
			.item-quantity {
			   width: 30%; /* 팔린갯수 span의 고정 너비 */
			   text-align: left; /* 왼쪽 정렬 */
			}
          
          
      </style>
   </head>
   <body class="dashboard dashboard_1">
      <div class="full_container">
         <div class="inner_container">
         
            <head th:include="fragments/user_sidebar :: sidebar"></head>
            <!-- right content -->
            <div id="content">
               <head th:include="fragments/user_topbar :: topbar"></head>
               
               
               <!-- dashboard inner -->
               <div class="midde_cont">
                  <div class="container-fluid">
                     <div class="row column_title">
                        <div class="col-md-12">
                           <div class="page_title">
                              <h2>Yamily-Mart 메인페이지</h2>
                           </div>
                        </div>
                     </div>
                     
                     <!-- 발주 상태별 건 수 -->
                     <div class="row column1">
                        <div class="col-md-6 col-lg-3">
                           <div class="full counter_section margin_bottom_30 gray_bg" style="background-color: gray;">
                              <div class="couter_icon">
                                 <div> 
                                    <i class="fa fa-spinner"></i>
                                 </div>
                              </div>
                              <div class="counter_no">
                                 <div>
                                    <th::block th:each="str: ${orderStatusList}">
                                       <p th:if="${str.order_status == 0}" class="total_no" style="color: white">[[${str.count}]] 건</p>
                                    </th::block>
                                    <p class="head_couter" style="color: white">발주대기</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                           <div class="full counter_section margin_bottom_30 blue1_bg">
                              <div class="couter_icon">
                                 <div> 
                                    <i class="fa fa-check-circle-o"></i>
                                 </div>
                              </div>
                              <div class="counter_no">
                                 <div>
                                    <th::block th:each="str: ${orderStatusList}">
                                       <p th:if="${str.order_status == 1}" class="total_no" style="color: white">[[${str.count}]] 건</p>
                                    </th::block>
                                    <p class="head_couter" style="color: white">발주승인</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                           <div class="full counter_section margin_bottom_30 green_bg">
                              <div class="couter_icon">
                                 <div> 
                                    <i class="fa fa-external-link-square"></i>
                                 </div>
                              </div>
                              <div class="counter_no">
                                 <div>
                                    <th::block th:each="str: ${orderStatusList}">
                                       <p th:if="${str.order_status == 2}" class="total_no" style="color: white">[[${str.count}]] 건</p>
                                    </th::block>                                    
                                    <p class="head_couter" style="color: white">입고완료</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                           <div class="full counter_section margin_bottom_30" style="background-color: #d34836;">
                              <div class="couter_icon">
                                 <div> 
                                    <i class="fa fa-times"></i>
                                 </div>
                              </div>
                              <div class="counter_no">
                                 <div>
                                    <th::block th:each="str: ${orderStatusList}">
                                       <p th:if="${str.order_status == 3}" class="total_no" style="color: white">[[${str.count}]] 건</p>
                                    </th::block>                                    
                                    <p class="head_couter" style="color: white">발주취소</p>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     
                     
                     <!-- 많이 판 제품 목록, 거래처 최근 주문 목록 -->
                     <div class="row column1">
                     
                        <div class="col-lg-6">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>제품별 인기순위</h2>
                                    </div>
                                 </div>
                                 <div class="full progress_bar_inner">
                                    <div class="row">
                                       <div class="col-md-12">
                                          <div class="msg_section">
                                             <div class="msg_list_main">
                                                <ul class="msg_list">
												   <th:block th:each="str, a: ${saleStatusList}">
												      <li class="item-row">
												         <span class="item-image">
												            <img style="width: 100px; height: 70px;" th:src="@{/display(filename=${str.product_image})}">
												         </span> 
												         <span class="item-info">
												            <span class="name_user">[[${a.index + 1}]]위 [[${str.product_name}]]</span>
												            <span class="msg_user" data-th-text="${#numbers.formatInteger(str.sum_amount * str.product_price, 3, 'COMMA') + '원'}"></span>
												         </span>
												         <span class="item-quantity">
												            팔린갯수:[[${str.sum_amount}]]
												         </span>
												      </li>
												   </th:block>
												</ul>
                                             </div>
                                               <div class="cover-bar"></div>
                                             
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           
                           <div class="col-lg-6">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>지점 일일매출</h2>
                                    </div>
                                 </div>
                                 <div class="full progress_bar_inner">
                                    <div class="row">
                                       <div class="col-md-12">
                                          <div class="msg_section">
                                             <div class="msg_list_main">
                                                <ul class="msg_list">
                                                
                                                   <th::block th:each="str: ${SaleTodayList}">
                                                      <li>
                                                         <span class="item-info">
                                                            <span class="name_user">시간: [[${str.sale_date}]]</span>
                                                            <span class="name_user">물품: [[${str.product_name}]]</span>
                                                         </span>
                                                         <span class="item-quantity">
                                                            <span class="name_user">팔린수량: [[${str.sale_amount}]]</span>
                                                            <span class="name_user">금액: [[${str.sale_sum}]]</span>
                                                         </span>
                                                      </li>
                                                   </th::block>
                                                   
                                                </ul>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           
                        </div>
                     </div>
                           
                           
                     </div>
                     
                     
                     
                       
                     
                     <!-- graph -->
                     <div class="row column2 graph margin_bottom_30">
                        <div class="col-md-l2 col-lg-12">
                           <div class="white_shd full">
                              <div class="full graph_head">
                                 <div class="heading1 margin_0">
                                    <h2>최근 6개월 지점 평균 월 매출</h2>
                                 </div>
                              </div>
                              <div class="full graph_revenue">
                                 <div class="row">
                                    <div class="col-md-12">
                                       <div class="content">
                                          <div class="area_chart">
                                             <canvas height="150" id="myChart"></canvas>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <!-- end graph -->
                     
                     
                     
                     
                     
                    
                  
                  
                  <!-- footer -->
                  <div class="container-fluid">
                     <div class="footer">
                        <p>Copyright © 2018 Designed by html.design. All rights reserved.<br><br>
                           Distributed By: <a href="https://themewagon.com/">ThemeWagon</a>
                        </p>
                     </div>
                  </div>
                  
                  
                  
               </div>
               <!-- end dashboard inner -->
               
            </div>
         </div>
      </div>
      
       <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
      
      <script th:inline="javascript">
         const currentDate = new Date();
         
        // 현재 달 구하기
        const month = currentDate.getMonth() + 1;
        
        var minus_m = 0;
        if((month-5) < 1) {
           minus_m = 12 + (month-5)
        }

           const chartData = [[${saleMonth}]];
           
           // 매출 변화율 계산
           const salesChangeRate = chartData.map((sales, index, array) => {
             if (index === 0) return null; // 첫 달은 변화율 없음
             return ((sales - array[index - 1]) / array[index - 1] * 100).toFixed(2);
           });

           // Chart.js 설정
           let myCt = document.getElementById('myChart');
            let myChart = new Chart(myCt, {
                 type: 'bar',
                 data: {
                   labels: [minus_m + "월", minus_m+1 + "월", minus_m+2 + "월", minus_m+3 + "월", minus_m+4 + "월", month + "월"],
                   datasets: [
                     {
                       label: '평균 월 매출 (원)',
                       data: chartData,
                       borderColor: "rgba(255, 99, 132, 1)",
                       backgroundColor: "rgba(255, 99, 132, 0.2)"
                     },
                     {
                         label: "매출 변화율 (%)",
                         data: salesChangeRate,
                         type: "line", // 라인형 그래프 추가
                         borderColor: "rgba(255, 99, 132, 1)",
                         backgroundColor: "rgba(255, 99, 132, 0.2)",
                         borderWidth: 2,
                         yAxisID: "y1", // 변화율 데이터 Y축
                       },
                   ]
                 },
                 options: {
                     scales: {
                         y: {
                             min: 10000000, // Y축의 최소값 설정
                             max: 60000000, // Y축의 최대값 설정
                         },
                     }
                 }

               });

      </script>
      
      
      <!-- jQuery -->
<!--       <script src="js/jquery.min.js"></script>
 -->      
 	 <script src="/js/popper.min.js"></script>
      <script src="/js/bootstrap.min.js"></script>
      <!-- wow animation -->
      <script src="/js/animate.js"></script>
      <!-- select country -->
      <script src="/js/bootstrap-select.js"></script>
      <!-- owl carousel -->
      <script src="/js/owl.carousel.js"></script> 
      <!-- chart js -->
      <script src="/js/Chart.min.js"></script>
      <script src="/js/Chart.bundle.min.js"></script>
      <script src="/js/utils.js"></script>
      <script src="/js/analyser.js"></script>
      <!-- nice scrollbar -->
      <script src="/js/perfect-scrollbar.min.js"></script>
      <script>
         var ps = new PerfectScrollbar('#sidebar');
      </script>
      <!-- custom js -->
      <script src="/js/custom.js"></script>
      <script src="/js/chart_custom_style2.js"></script>
   </body>
</html>