<!DOCTYPE html >
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>발주 요청 관리</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- site icon -->
      <link rel="icon" href="/images/fevicon.png" type="image/png" />
      <!-- bootstrap css -->
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
      <!-- site css -->
      <link rel="stylesheet" href="/css/style.css" />
      <!-- responsive css -->
      <link rel="stylesheet" href="/css/responsive.css" />
      <!-- color css -->
      <!-- <link rel="stylesheet" href="/css/color_2.css" />  -->
      <link rel="stylesheet" href="/css/colors.css" />
      <!-- select bootstrap -->
      <link rel="stylesheet" href="/css/bootstrap-select.css" />
      <!-- scrollbar css -->
      <link rel="stylesheet" href="/css/perfect-scrollbar.css" />
      <!-- custom css -->
      <link rel="stylesheet" href="/css/custom.css" />
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
      
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  	  <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
    
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    	<!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>  -->
    
    
   	  <style>
   	    #modalOpenButton, #modalCloseButton {
		  cursor: pointer;
		}
		
		#modalContainer {
		  width: 100%;
		  height: 100%;
		  position: fixed;
		  top: 0;
		  left: 0;
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  background: rgba(0, 0, 0, 0.5);
		}
		
		#modalContent {
		  position: absolute;
		  background-color: #ffffff;
		  width: 1000px;
		  height: 730px;
		  padding: 15px;
		}
		
		#modalContainer.hidden {
		  display: none;
		}
   	  
   	  </style>
   
   </head>
   <body class="dashboard dashboard_1">
      <div class="full_container">
         <div class="inner_container">
            <head th:include="fragments/sidebar :: sidebar"></head>
            <!-- right content -->
            <div id="content">
            	<head th:include="fragments/topbar :: topbar"></head>

			<!-- 메인 내용 -->
              <div class="main p-5">
			      <h6>
			         <strong>발주 요청 목록</strong>
			      </h6>
			      
			  <!-- 필터 -->
		      <form action="/admin/order/list" method="post">
		         <table class="table table-bordered">
		            <tr>
		               <th>검색어</th>
		               <td>		               		
		               		<select><option>지점명</option></select>
		               		<input type="text" name="keyword" placeholder="검색어 입력">
		               </td>
		            </tr>
               <tr>
               	   <th>발주일자</th>
		               <td>
		                <input type="date" value="0" id="startDate1" name="startDate1"> - 
		                <input type="date" value="0" id="endDate1" name="endDate1">
		                  <!-- 
		                  <div class="date-buttons" style="display: inline-block;">
		                     <button type="button" onclick="setDate(-1)">1일</button>
		                     <button type="button" onclick="setDate(-3)">3일</button>
		                     <button type="button" onclick="setDate(-7)">일주일</button>
		                     <button type="button" onclick="setDate(-30)">한달</button>
		                  </div>
		                   -->
		               </td>
               		</tr>
           			 <tr>
			               <th>납기일자</th>
			               <td>
			               <input type="date" value="0" id="startDate2" name="startDate2"> - 
			               <input type="date" value="0" id="endDate2" name="endDate2">
                  <!-- 
                  <div class="date-buttons" style="display: inline-block;">
                     <button type="button" onclick="setDate(-1)">1일</button>
                     <button type="button" onclick="setDate(-3)">3일</button>
                     <button type="button" onclick="setDate(-7)">일주일</button>
                     <button type="button" onclick="setDate(-30)">한달</button>
                  </div>
                  -->
		               </td>
		            </tr>
		            <tr>
		               <th>발주상태</th>
		               <td>
							<input type="radio" name="status" value="0" checked="checked">발주대기
							<input type="radio" name="status" value="1">발주승인
							<input type="radio" name="status" value="2">발주취소
							<input type="radio" name="status" value="3">입고완료
		               </td>
		            </tr>
         	</table>
         
	         <div style="text-align: right;">
	            <button type="submit" class="btn btn-primary btn-sm"
	               style="width: 70px; border-radius: 8px;">검색</button>
	            <button type="reset" class="btn btn-secondary btn-sm"
	               style="width: 70px; border-radius: 8px;">초기화</button>
	         </div>
         
      </form>
       <!-- 필터 끝 -->
      
      
      <hr style="color: black">

      <div class="wrapper mt-5" id="productListContainer">

         <table class="table product-list-table">
            <thead>
               <tr>
                  <th class="table-light text-center">발주코드</th>
                  <th class="table-light text-center">지점명</th>
                  <th class="table-light text-center">발주일자</th>
                  <th class="table-light text-center">납기일자</th>
                  <th class="table-light text-center">발주수량</th>
                  <th class="table-light text-center">총 금액</th>
                  <th class="table-light text-center">발주상태</th>
                  <th class="table-light text-center">관리</th>
               </tr>
            </thead>
            <tbody>
            	<th::block th:each="str: ${list}">
					     <tr>
	                         <td style="text-align: center; vertical-align: middle;">[[${str.order_id}]]</td>
  	                         <td style="text-align: center; vertical-align: middle;">[[${str.branch_name}]]</td>
	                         <td style="text-align: center; vertical-align: middle;">[[${str.order_date}]]</td>
	                         <td style="text-align: center; vertical-align: middle;">[[${str.order_delivery}]]</td>
	                         <td style="text-align: center; vertical-align: middle;">[[${str.order_amount}]]</td>    
  	                         <td style="text-align: center; vertical-align: middle;">
  	                         <div data-th-text="${#numbers.formatInteger(str.order_sum, 3, 'COMMA') + '원'}"></div>
  	                         </td>    
  	                         <td style="text-align: center;">
  	                         	<th:block th:switch="${str.order_status}">
									<span th:case="0"><button type="button" class="btn cur-p btn-secondary">발주대기</button></span>
									<span th:case="1"><button type="button" class="btn cur-p btn-primary">발주승인</button></span>
									<span th:case="2"><button type="button" class="btn cur-p btn-success">입고완료</button></span>
									<span th:case="2"><button type="button" class="btn cur-p btn-danger">발주취소</button></span>
								</th:block>
  	                         </td>
  	                         
                         	 <td style="text-align: center;"><button type="button" class="btn cur-p btn-outline-primary" th:onclick="orderDetail2([[${str.order_id}]])">상세보기</button></td>
	                      </tr> 
				</th:block>
            </tbody>
         </table>
         <br>
         <div></div>
         <br>
      </div>

		<!-- 모달 -->
		 <div id="modalContainer" class="hidden">
		  	<div id="modalContent">
		  
			  	<div style="margin: 10px; text-align: right; float: center;">
			  		<a id="modalCloseButton" style="text-align: right; margin: 0 0 0 0;"><img style="width: 20px; height: 20px;" src="/images/close.png" alt=""></a>
			  	</div>
			  	
			  	<div style="margin: 10px; text-align: center; float: center;">
			  		<div>
				  		<h4 style="text-align: center;">발주 상세 정보</h4>
			  		</div>
			  	</div>
		    
		    		<table class="table table-bordered">
			            <tr>
			               <th>주문ID</th>
   			               <td><input id="order_id" type="text" readonly/></td>
   			               <th>지점명</th>
   			               <th><input id="order_partnerid" type="text" readonly/></th>
			            </tr>
			            <tr>
			               <th>발주일자</th>
   			               <td><input id="order_date" type="text" readonly/></td>
   			               <th>납기일자</th>
   			               <th><input id="order_delivery" type="text" readonly/></th>
			            </tr>
			            <tr>
			               <th>담당자명</th>
   			               <td><input id="order_manager" type="text" readonly/></td>
   			               <th>발주상태</th>
   			               
   			               <!-- <th><input id="order_status" type="text" readonly/></th>  -->
   			               
   			               <th style="text-align: left;" id="order_status_btn">
  	                         	
  	                       </th>

			            </tr>
			            <tr>
			               <th>수량</th>
   			               <td><input id="order_amount" type="text" readonly/></td>
   			               <th>메모</th>
   			               <td><input id="order_memo" type="text" readonly/></td>
			            </tr> 
		            </table>

					<div id="productListContainer2">
					    <table class="table product-list-table">
					        <thead>
					            <tr>
					                <th class="table-light text-center">NO</th>
					                <th class="table-light text-center">발주코드</th>
					                <th class="table-light text-center">상품코드</th>
					                <th class="table-light text-center">가격</th>
					                <th class="table-light text-center">수량</th>
					                <th class="table-light text-center">총합</th>
					            </tr>
					        </thead>
					        <tbody id="a">
					            <!-- 데이터가 여기 추가됩니다 -->
					        </tbody>
					    </table>
					</div>
				
					<div style="margin: 0 30px 0 0; text-align: right;">
						<h5>합계</h5>
						<h2 id="order_sum"></h2>
					</div>
	
					<div style="margin: 0 30px 0 0; text-align: center;">
						<div>
							<button type="button" class="btn cur-p btn-danger">거절</button>
							<button type="button" class="btn cur-p btn-success">승인</button>
						</div>
					</div>
		  	</div>
		</div>
		<!-- 모달 끝 -->

		<!-- 
		<div class="pagination-container">
		    <div class="pagination">
		        <c:if test="${startPage > 1}">
		            <a href="${basePath}?pageNum=${startPage - 1}&pageListNum=${pageListNum}&searchType=${searchType}&searchKeyword=${searchKeyword}&startDate=${startDate}&endDate=${endDate}">&lt;</a>
		        </c:if>
		        <c:forEach begin="${startPage}" end="${endPage}" var="page">
		            <a href="${basePath}?pageNum=${page}&pageListNum=${pageListNum}&searchType=${searchType}&searchKeyword=${searchKeyword}&startDate=${startDate}&endDate=${endDate}"
		               class="${currentPage == page ? 'active' : ''}">${page}</a>
		        </c:forEach>
		        <c:if test="${endPage < totalPage}">
		            <a href="${basePath}?pageNum=${endPage + 1}&pageListNum=${pageListNum}&searchType=${searchType}&searchKeyword=${searchKeyword}&startDate=${startDate}&endDate=${endDate}">&gt;</a>
		        </c:if>
		    </div>
		</div>  
		-->
	 
   </div>
               
   <!-- 메인 내용 END -->
               

            </div>
         </div>
      </div>
      
    
    <script>
	      function orderDetail2(order_id) {	
					//order 정보 요청		    	
		    	    $.ajax({
		    	        url: '/admin/order/detail2',
		    	        method: 'GET',
		    	        data: {order_id: order_id},
		    	        success: function(result) {
		    	            if (result) {
		    	                
		    	        	    document.getElementById("order_id").value = result.order_id;
		    	        	    document.getElementById("order_partnerid").value = result.branch_name;
		    	        	    //document.getElementById("order_sender").value = result.order_sender;
		    	        	    document.getElementById("order_date").value = result.order_date;
		    	        	    document.getElementById("order_amount").value = result.order_amount;
		    	        	    document.getElementById("order_manager").value = result.order_manager;
		    	        	    document.getElementById("order_delivery").value = result.order_delivery;
		    	        	    document.getElementById("order_memo").value = result.order_memo;
		    	        	    
		    	        	    const heading = document.getElementById('order_sum');
		    	                heading.textContent = result.order_sum;
		    	                
		    	                const buttonsContainer = document.getElementById('order_status_btn');
		    	                buttonsContainer.innerHTML = '';
		    	                switch (result.order_status) {
		    	                	case 0:
				    	                buttonsContainer.innerHTML = '<button type="button" class="btn cur-p btn-secondary">발주대기</button>';
		    	                		break;
		    	                	case 1:
				    	                buttonsContainer.innerHTML = '<button type="button" class="btn cur-p btn-primary">발주승인</button>';
				    	                break;
		    	                	case 2:
				    	                buttonsContainer.innerHTML = '<button type="button" class="btn cur-p btn-success">입고완료</button>';
				    	                break;
		    	                	case 3:
				    	                buttonsContainer.innerHTML = '<button type="button" class="btn cur-p btn-danger">발주취소</button>';
				    	                break;
				    	            default:
				    	            	buttonsContainer.innerHTML = '<button type="button" class="btn cur-p btn-secondary">발주대기</button>';
				    	            	break;
		    	                }
		    	        	    
		    	        	    const modal = document.getElementById('modalContainer');
		    			  	    modal.classList.remove('hidden');
		    	        	      
		    	            } else {
		    	                alert("데이터 응답 실패");
		    	            }
		    	        },
		    	        error: function(xhr, status, error) {
		    	            alert("Ajax 요청 실패");
		    	        }
		    	    });
		    	    
		    	    //orderDetail 정보 요청
		    	    $.ajax({
		    	        url: '/admin/order/detail',
		    	        method: 'GET',
		    	        data: { orderDetail_orderid: order_id },
		    	        success: function(result) {
		    	            if (result && result.length > 0) {
		    	                const tbody = document.querySelector('#productListContainer2 tbody');
		    	                tbody.innerHTML = ''; // 기존 데이터를 초기화

		    	                // 리스트를 순회하며 테이블 행 생성
		    	                result.forEach((detail) => {
		    	                    const tr = document.createElement('tr');
		
		    	                    tr.innerHTML = `
		    	                        <td style="text-align: center;">${detail.orderDetail_id}</td>
		    	                        <td style="text-align: center;">${detail.orderDetail_orderid}</td>
		    	                        <td style="text-align: center;">${detail.product_name}</td>
		    	                        <td style="text-align: center;">${detail.product_price}</td>
		    	                        <td style="text-align: center;">${detail.orderDetail_amount}</td>
		    	                        <td style="text-align: center;">${detail.orderDetail_sum}</td>
		    	                    `;
		    	                    		    	                    
		    	                    tbody.appendChild(tr);
		    	                });

		    	                // 모달 표시
		    	                const modal = document.getElementById('modalContainer');
		    	                modal.classList.remove('hidden');
		    	                
		    	            } else {
		    	            	alert("데이터 응답 실패");
		    	            }
		    	        },
		    	        error: function(xhr, status, error) {
		    	            alert("Ajax 요청 실패: " + xhr.status + " " + error);
		    	        }
		    	    });

	    	}
    </script>

      
      <script>
      	  const modalOpenButton = document.getElementById('modalBtn');
	      const modalCloseButton = document.getElementById('modalCloseButton');
	      const modal = document.getElementById('modalContainer');
	
	      modalCloseButton.addEventListener('click', () => {
	        modal.classList.add('hidden');
	      });
	      
	        window.addEventListener('click', (event) => {
	            if (event.target === modal) { // 클릭된 요소가 모달 배경인지 확인
	    	        modal.classList.add('hidden');
	            }
	        });
      </script>

      
      <!-- jQuery -->
      <!-- <script src="/js/jquery.min.js"></script> -->
      <script src="/js/popper.min.js"></script>
      <script src="/js/bootstrap.min.js"></script>
      <!-- wow animation -->
      <script src="/js/animate.js"></script>
      <!-- select country -->
      <script src="/js/bootstrap-select.js"></script>
      <!-- owl carousel -->
      <script src="/js/owl.carousel.js"></script> 
      <!-- chart js -->
      <script src="/js/Chart.min.js"></script>
      <script src="/js/Chart.bundle.min.js"></script>
      <script src="/js/utils.js"></script>
      <script src="/js/analyser.js"></script>
      <!-- nice scrollbar -->
      <script src="/js/perfect-scrollbar.min.js"></script>
      <script>
         var ps = new PerfectScrollbar('#sidebar');
      </script>
      <!-- custom js -->
      <script src="/js/chart_custom_style1.js"></script>
      <script src="/js/custom.js"></script>
   </body>
</html>