<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.yamilymart.dao.YamilyDao">

    <insert id="admin_stock_product_add" parameterType="ProductDTO">
        insert into product(product_id, product_partnerid, product_name, product_price)
        values (#{product_id}, #{product_partnerid}, #{product_name}, #{product_price})
    </insert>
    
    <insert id="admin_stock_add" parameterType="StockDTO">
        insert into stock(stock_productid, stock_remain, stock_type)
        values (#{product_id}, 0, 1)
    </insert>
    
    <update id="admin_stock_update_post" parameterType="ProductDTO">
        update product
        set product_price = #{product_price}, product_name = #{product_name}
        where product_id = #{product_id}
    </update>
    
    <select id="admin_order_list_search" parameterType="OrderSearchDTO">
    	select * from `order`, branch 
    	where `order`.order_sender = branch.branch_id
    	and `order`.order_status = #{status}
   		<if test="keyword != ''">
   			and branch.branch_name like concat('%',#{keyword},'%')
   		</if>
   		<if test="startDate1 != ''">
   			and `order`.order_date &gt;= #{startDate1}
   		</if>
   		<if test="startDate2 != ''">
   			and `order`.order_delivery &gt;= #{startDate2}
   		</if>
   		<if test="endDate1 != ''">
   			and `order`.order_date &lt;= #{endDate1}
   		</if>
   		<if test="endDate2 != ''">
   			and `order`.order_delivery &lt;= #{endDate2}
   		</if>
    </select>
    
    <select id="admin_stock_list_search">
    	select * from `stock`, `product` 
    	where stock.stock_productid = product.product_id 
    	and stock.stock_type = 1
   		<if test="searchType == 0">
   			and product.product_name like concat('%',#{keyword},'%')
   		</if>
   		<if test="searchType == 1">
   			and product.product_id like concat('%',#{keyword},'%')
   		</if>
    </select>
    
    <select id="admin_sale_list">
		select 
		    SUM(sale.sale_sum) AS sale_sum, 
		    sale.sale_branchid, 
		    sale.sale_date, 
		    branch.branch_name, 
		    branch.branch_id
		from 
		    sale
		join 
		    branch 
		on 
		    branch.branch_id = sale.sale_branchid
		group by
		    sale.sale_date, 
		    sale.sale_branchid, 
		    branch.branch_name, 
		    branch.branch_id;
    </select>
    
    <select id="admin_sale_list_search">
    	select 
		    SUM(sale.sale_sum) AS sale_sum, 
		    sale.sale_branchid, 
		    sale.sale_date, 
		    branch.branch_name, 
		    branch.branch_id
		from 
		    sale
		join 
		    branch 
		on 
		    branch.branch_id = sale.sale_branchid
		    <if test="keyword != ''">
	   			and branch.branch_name like concat('%',#{keyword},'%')
	   		</if>
	   		<if test="startDate != ''">
	   			and sale.sale_date &gt;= #{startDate}
	   		</if>
	   		<if test="endDate != ''">
	   			and sale.sale_date &lt;= #{endDate}
	   		</if>
		group by
		    sale.sale_date, 
		    sale.sale_branchid, 
		    branch.branch_name, 
		    branch.branch_id;
    </select>
    
    <select id="admin_sale_detail">
	    select sale.sale_productid, sale.sale_branchid, sum(sale_amount) sale_amount, sum(sale_sum) sale_sum, 
	    product.product_name, product.product_price, partner.partner_name
		from sale, branch, partner, product
		where sale_branchid = #{sale_branchid} 
		and sale_date = #{sale_date} 
		and sale.sale_branchid = branch.branch_id 
		and sale.sale_productid = product.product_id 
		and product.product_partnerid = partner.partner_id
		group by sale.sale_productid, sale.sale_branchid
    </select>

    

</mapper>